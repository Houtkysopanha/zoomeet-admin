<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Image URLs Diagnostic</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .image-test {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .image-container {
            width: 150px;
            height: 100px;
            border: 1px solid #ccc;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .image-info {
            flex: 1;
        }
        .url-display {
            font-size: 11px;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            word-break: break-all;
            margin: 5px 0;
            font-family: monospace;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin: 2px 0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #cce7ff; color: #0066cc; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .loading {
            color: #666;
            font-style: italic;
        }
        .json-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }
        h1, h2, h3 { color: #333; }
        .error-text { color: #721c24; font-weight: bold; }
        .success-text { color: #155724; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç API Image URLs Diagnostic Tool</h1>
        <p>This diagnostic tool will help identify why images from recent events and upcoming events APIs are not loading properly.</p>
        
        <div class="container">
            <h3>Test Controls</h3>
            <button onclick="testSampleAPIUrls()">Test Sample API URLs</button>
            <button onclick="testFallbackImages()">Test Fallback Images</button>
            <button onclick="testCORSUrls()">Test CORS Issues</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        // Sample data matching the actual API responses
        const apiTestData = {
            recentEvents: [
                {
                    id: "320450d5-6f86-41fb-bc96-52fce83b6083",
                    name: "Shaping the Future with Technology",
                    cover_image_url: "https://dev-ticket7777.s3.ap-southeast-2.amazonaws.com/E-Ticket-App_040925-1200x630.jpg",
                    total_revenue: 5,
                    total_booking: 1,
                    total_ticket: 3
                },
                {
                    id: "42e72abf-eb82-4cfe-ba8c-b69f3977b187",
                    name: "Test90",
                    cover_image_url: "https://dev-ticket7777.s3.ap-southeast-2.amazonaws.com/360_F_428746156_7AnuhVzfDzmFQdaF3kFBXQRv3U0mHKbE.jpg",
                    total_revenue: 0,
                    total_booking: 0,
                    total_ticket: 0
                },
                {
                    id: "empty-url-test",
                    name: "Event with Empty URL",
                    cover_image_url: "",
                    total_revenue: 0,
                    total_booking: 0,
                    total_ticket: 0
                },
                {
                    id: "null-url-test",
                    name: "Event with Null URL",
                    cover_image_url: null,
                    total_revenue: 0,
                    total_booking: 0,
                    total_ticket: 0
                }
            ],
            upcomingEvents: [
                {
                    id: "sample-upcoming-1",
                    name: "Upcoming Tech Conference",
                    cover_image_url: "https://dev-ticket7777.s3.ap-southeast-2.amazonaws.com/tech-conference.jpg",
                    start_date: "2025-10-15T09:00:00",
                    end_date: "2025-10-15T17:00:00"
                },
                {
                    id: "sample-upcoming-2",
                    name: "Workshop on AI",
                    cover_image_url: "", // Empty URL
                    start_date: "2025-10-20T10:00:00",
                    end_date: "2025-10-20T16:00:00"
                }
            ],
            fallbackImages: [
                '/assets/image/poster-manage-booking.png',
                '/assets/image/logo.png',
                '/assets/image/star.png'
            ]
        }

        function testImageLoad(url, eventName = 'Unknown Event') {
            return new Promise((resolve) => {
                if (!url || url === null || url === undefined) {
                    resolve({ 
                        success: false, 
                        error: 'Empty, null, or undefined URL', 
                        url: url || 'null/undefined',
                        eventName: eventName
                    })
                    return
                }

                const img = new Image()
                const startTime = performance.now()
                
                img.onload = () => {
                    const loadTime = Math.round(performance.now() - startTime)
                    resolve({ 
                        success: true, 
                        url: url,
                        eventName: eventName,
                        dimensions: `${img.naturalWidth}x${img.naturalHeight}`,
                        loadTime: `${loadTime}ms`
                    })
                }
                
                img.onerror = (error) => {
                    const loadTime = Math.round(performance.now() - startTime)
                    resolve({ 
                        success: false, 
                        error: 'Failed to load image', 
                        url: url,
                        eventName: eventName,
                        loadTime: `${loadTime}ms`,
                        details: 'Image load error - Check CORS, URL validity, or network issues'
                    })
                }
                
                // Set a timeout for slow-loading images
                setTimeout(() => {
                    resolve({ 
                        success: false, 
                        error: 'Image load timeout (5s)', 
                        url: url,
                        eventName: eventName,
                        loadTime: '5000ms+',
                        details: 'Image took too long to load - Check network or server response'
                    })
                }, 5000)
                
                img.src = url
            })
        }

        async function testSampleAPIUrls() {
            const resultsDiv = document.getElementById('results')
            resultsDiv.innerHTML = '<div class="loading">Testing API image URLs...</div>'
            
            let htmlOutput = '<h2>üìä API Image URLs Test Results</h2>'
            
            // Test Recent Events Images
            htmlOutput += '<h3>Recent Events Images</h3>'
            for (const event of apiTestData.recentEvents) {
                const result = await testImageLoad(event.cover_image_url, event.name)
                htmlOutput += generateImageTestHTML(result, 'recent-event')
            }
            
            // Test Upcoming Events Images
            htmlOutput += '<h3>Upcoming Events Images</h3>'
            for (const event of apiTestData.upcomingEvents) {
                const result = await testImageLoad(event.cover_image_url, event.name)
                htmlOutput += generateImageTestHTML(result, 'upcoming-event')
            }
            
            // Add diagnosis
            htmlOutput += generateDiagnosis()
            
            resultsDiv.innerHTML = htmlOutput
        }

        async function testFallbackImages() {
            const resultsDiv = document.getElementById('results')
            resultsDiv.innerHTML = '<div class="loading">Testing fallback images...</div>'
            
            let htmlOutput = '<h2>üõ°Ô∏è Fallback Images Test</h2>'
            
            for (const url of apiTestData.fallbackImages) {
                const result = await testImageLoad(url, 'Fallback Image')
                htmlOutput += generateImageTestHTML(result, 'fallback')
            }
            
            resultsDiv.innerHTML = htmlOutput
        }

        async function testCORSUrls() {
            const resultsDiv = document.getElementById('results')
            resultsDiv.innerHTML = '<div class="loading">Testing CORS issues...</div>'
            
            let htmlOutput = '<h2>üåê CORS Issues Test</h2>'
            
            const corsTestUrls = [
                { url: 'https://dev-ticket7777.s3.ap-southeast-2.amazonaws.com/E-Ticket-App_040925-1200x630.jpg', description: 'S3 Image (AP-Southeast-2)' },
                { url: 'https://httpbin.org/image/png', description: 'External Test Image' },
                { url: 'https://via.placeholder.com/300x200.png', description: 'Placeholder Service' },
                { url: 'http://example.com/image.jpg', description: 'HTTP URL (Mixed Content)' }
            ]
            
            for (const testCase of corsTestUrls) {
                const result = await testImageLoad(testCase.url, testCase.description)
                htmlOutput += generateImageTestHTML(result, 'cors-test')
            }
            
            htmlOutput += `
                <div class="container">
                    <h4>üîç CORS Diagnostic Information</h4>
                    <p><strong>Current Location:</strong> ${window.location.origin}</p>
                    <p><strong>Protocol:</strong> ${window.location.protocol}</p>
                    <p><strong>User Agent:</strong> ${navigator.userAgent}</p>
                    
                    <h4>Common CORS Solutions:</h4>
                    <ul>
                        <li><strong>Server Proxy:</strong> Route images through your Nuxt server</li>
                        <li><strong>S3 CORS Config:</strong> Configure AWS S3 bucket CORS policy</li>
                        <li><strong>CDN Headers:</strong> Ensure proper CORS headers from CDN</li>
                        <li><strong>Image Proxy Service:</strong> Use a third-party image proxy</li>
                    </ul>
                </div>
            `
            
            resultsDiv.innerHTML = htmlOutput
        }

        function generateImageTestHTML(result, category) {
            const statusClass = result.success ? 'success' : 'error'
            const statusText = result.success ? '‚úÖ SUCCESS' : '‚ùå FAILED'
            const dimensions = result.dimensions ? ` (${result.dimensions})` : ''
            const loadTime = result.loadTime ? ` - ${result.loadTime}` : ''
            
            return `
                <div class="image-test">
                    <div class="image-container">
                        ${result.success ? 
                            `<img src="${result.url}" alt="${result.eventName}" onerror="this.style.display='none'">` : 
                            '<div style="color:#999;font-size:12px;text-align:center;">‚ùå<br>Failed</div>'
                        }
                    </div>
                    <div class="image-info">
                        <div><strong>${result.eventName}</strong></div>
                        <div class="status ${statusClass}">${statusText}${dimensions}${loadTime}</div>
                        <div class="url-display">${result.url}</div>
                        ${result.error ? `<div style="color: red; font-size: 12px; margin-top: 5px;"><strong>Error:</strong> ${result.error}</div>` : ''}
                        ${result.details ? `<div style="color: #666; font-size: 11px; margin-top: 3px;"><strong>Details:</strong> ${result.details}</div>` : ''}
                    </div>
                </div>
            `
        }

        function generateDiagnosis() {
            return `
                <div class="container">
                    <h3>üéØ Diagnostic Summary</h3>
                    
                    <h4>Image URL Structure Analysis:</h4>
                    <div class="json-display">
Recent Events API Response Structure:
{
  "data": {
    "recently_event": [
      {
        "id": "event-id",
        "name": "Event Name",
        "cover_image_url": "https://dev-ticket7777.s3.ap-southeast-2.amazonaws.com/image.jpg",
        "total_revenue": 5,
        "total_booking": 1,
        "total_ticket": 3
      }
    ]
  }
}

Upcoming Events API Response Structure:
{
  "data": [
    {
      "id": "event-id",
      "name": "Event Name",
      "cover_image_url": "https://dev-ticket7777.s3.ap-southeast-2.amazonaws.com/image.jpg",
      "start_date": "2025-10-15T09:00:00",
      "end_date": "2025-10-15T17:00:00"
    }
  ]
}
                    </div>

                    <h4>Component Image Mapping:</h4>
                    <div class="info">
                        <p><strong>Recent Events:</strong> <code>event.cover_image_url</code> ‚Üí <code>event.image</code></p>
                        <p><strong>Upcoming Events:</strong> <code>event.cover_image_url</code> ‚Üí <code>event.image</code></p>
                        <p><strong>Fallback:</strong> <code>/assets/image/poster-manage-booking.png</code></p>
                    </div>

                    <h4>Potential Issues Identified:</h4>
                    <ul>
                        <li><strong>AWS S3 CORS Policy:</strong> S3 bucket may not allow cross-origin requests</li>
                        <li><strong>Empty URLs:</strong> API returning empty or null image URLs</li>
                        <li><strong>Pre-signed URLs:</strong> URLs might be expired or require authentication</li>
                        <li><strong>Network Issues:</strong> Regional connectivity to ap-southeast-2 S3 bucket</li>
                        <li><strong>Mixed Content:</strong> HTTP images on HTTPS site</li>
                    </ul>

                    <h4>Recommended Solutions:</h4>
                    <ol>
                        <li><strong>Implement Image Validation:</strong> Check URL validity before rendering</li>
                        <li><strong>Better Error Handling:</strong> Improve @error handlers in Vue components</li>
                        <li><strong>Server-side Image Proxy:</strong> Route images through Nuxt server</li>
                        <li><strong>Default Image Strategy:</strong> Always provide working fallback images</li>
                        <li><strong>AWS S3 Configuration:</strong> Update S3 bucket CORS policy</li>
                    </ol>
                </div>
            `
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = ''
        }

        // Auto-run test on page load
        window.onload = function() {
            testSampleAPIUrls()
        }
    </script>
</body>
</html>